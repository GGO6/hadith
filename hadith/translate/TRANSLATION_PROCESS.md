# ุดุฑุญ ุนูููุฉ ุงูุชุฑุฌูุฉ - ุฎุทูุฉ ุจุฎุทูุฉ

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูุชุฑุฌูุฉ ูุณุชุฎุฏู ููุฌ **ูุฌูู** ูุฌูุน ุจูู:
1. **NLLB** (ูุญููุ ูุฌุงูู) - ููุชุฑุฌูุฉ ุงูุฃุณุงุณูุฉ
2. **GPT-4o-mini** (APIุ ุฑุฎูุต) - ููุฑุงุฌุนุฉ ุงูุชุฑุฌูุงุช ุงููุดููู ูููุง

---

## ุงููุฑุญูุฉ 1: ุงูุชููุฆุฉ ูุงูุฅุนุฏุงุฏ

### 1.1 ุชุญููู ุงููููุฐุฌ
```python
# ูู translator.py
translator = NLLBTranslator()
```

**ูุง ูุญุฏุซ:**
- ุชุญููู ูููุฐุฌ NLLB-200 (ุญุฌู ~5.1 GB)
- ุชุญููู Tokenizer ููุชุนุงูู ูุน ุงููุตูุต
- ุฅุนุฏุงุฏ ุงูุฌูุงุฒ (CPU ุฃู GPU ุฅู ูุฌุฏ)
- ุจูุงุก ุฎุฑูุทุฉ ุฑููุฒ ุงููุบุงุช

**ุงูููุช:** 2-5 ุฏูุงุฆู (ูู ุงููุฑุฉ ุงูุฃููู)

### 1.2 ุชุญููู ุงููุชุจ
```python
# ูู run_translation.py
books = load_all_books()
```

**ูุง ูุญุฏุซ:**
- ุงูุจุญุซ ุนู ุฌููุน ูููุงุช `metadata.json` ูู ูุฌูุฏ ุงููุชุจ
- ุชุญููู ูุนูููุงุช ูู ูุชุงุจ (ุงููุตููุ ุนุฏุฏ ุงูุฃุญุงุฏูุซุ ุฅูุฎ)
- ุชุฑุชูุจ ุงููุชุจ ุญุณุจ ุฑูููุง

---

## ุงููุฑุญูุฉ 2: ูุนุงูุฌุฉ ูู ูุชุงุจ

### 2.1 ุงุฎุชูุงุฑ ุงููุชุงุจ
```python
for book in books:
    translate_book(book, language, checkpoint)
```

**ูุง ูุญุฏุซ:**
- ูุชู ูุนุงูุฌุฉ ูู ูุชุงุจ ุนูู ุญุฏุฉ
- ูุชู ุงูุชุญูู ูู Checkpoint ูุชุฌูุจ ุฅุนุงุฏุฉ ุชุฑุฌูุฉ ูุง ุชู ุชุฑุฌูุชู

### 2.2 ูุนุงูุฌุฉ ุงููุตูู

#### ุฃ) ูููุชุจ ุงูููุณูุฉ ุนูู ูุตูู (ูุซู ุงูุจุฎุงุฑู)
```python
for chapter in chapters:
    chapter_data = load_chapter_file(chapter_file)
    hadiths = chapter_data.get('hadiths', [])
```

**ูุง ูุญุฏุซ:**
- ุชุญููู ููู ุงููุตู (ูุซู `1.json`)
- ุงุณุชุฎุฑุงุฌ ูุงุฆูุฉ ุงูุฃุญุงุฏูุซ ูู ุงููุตู

#### ุจ) ูููุชุจ ุบูุฑ ุงูููุณูุฉ (ูุซู ุงูุฃุฑุจุนููุงุช)
```python
all_file = book_path / "all.json"
chapter_data = load_chapter_file(all_file)
```

**ูุง ูุญุฏุซ:**
- ุชุญููู ููู `all.json` ุงูุฐู ูุญุชูู ุนูู ุฌููุน ุงูุฃุญุงุฏูุซ

---

## ุงููุฑุญูุฉ 3: ุงุณุชุฎุฑุงุฌ ุงููุตูุต ุงูุฅูุฌููุฒูุฉ

### 3.1 ุงุณุชุฎุฑุงุฌ ูุต ูู ุญุฏูุซ
```python
def extract_hadith_text(hadith):
    english = hadith.get('english', {})
    narrator = english.get('narrator', '')
    text = english.get('text', '')
    return f"{narrator} {text}".strip()
```

**ูุซุงู:**
```json
{
  "english": {
    "narrator": "I heard the Messenger of Allah say:",
    "text": "Actions are judged by intentions."
  }
}
```

**ุงููุชูุฌุฉ:**
```
"I heard the Messenger of Allah say: Actions are judged by intentions."
```

---

## ุงููุฑุญูุฉ 4: ุงูุชุฑุฌูุฉ ุจุงูุฏูุนุงุช (Batch Processing)

### 4.1 ุชุฌููุน ุงููุตูุต
```python
hadith_texts = []
for hadith in hadiths_to_translate:
    english_text = extract_hadith_text(hadith)
    hadith_texts.append(english_text)
```

**ูุง ูุญุฏุซ:**
- ุฌูุน ุฌููุน ุงููุตูุต ุงูุฅูุฌููุฒูุฉ ูู ูุงุฆูุฉ
- ุญุฌู ุงูุฏูุนุฉ: 8 ุฃุญุงุฏูุซ (ูุงุจู ููุชุนุฏูู ูู `config.py`)

### 4.2 ุงูุชุฑุฌูุฉ ุจุงูุฏูุนุงุช
```python
batch_size = 8  # ูู config.py
for i in range(0, len(hadith_texts), batch_size):
    batch_texts = hadith_texts[i:i+batch_size]
    batch_translated = translator.translate_batch(batch_texts, target_lang_code)
```

**ูุง ูุญุฏุซ ุฏุงุฎู `translate_batch`:**

#### ุฎุทูุฉ 1: Tokenization
```python
inputs = tokenizer(
    texts,  # ูุงุฆูุฉ ุงููุตูุต
    return_tensors="pt",
    padding=True,      # ุฅุถุงูุฉ padding ูููุตูุต ุงููุตูุฑุฉ
    truncation=True,   # ูุทุน ุงููุตูุต ุงูุทูููุฉ
    max_length=512     # ุงูุญุฏ ุงูุฃูุตู ููุทูู
)
```

**ูุซุงู:**
```
Input: ["Hello", "How are you?"]
Tokens: [[101, 7592], [101, 2129, 2024, 2017, 1029]]
Padded: [[101, 7592, 0, 0, 0], [101, 2129, 2024, 2017, 1029]]
```

#### ุฎุทูุฉ 2: ุชุญุฏูุฏ ุงููุบุฉ ุงููุฏู
```python
target_lang_id = lang_to_id.get(target_lang)  # ูุซู "tur_Latn"
forced_bos_token_id = target_lang_id  # ุฅุฌุจุงุฑ ุงููุบุฉ ูู ุงูุจุฏุงูุฉ
```

**ูุง ูุญุฏุซ:**
- NLLB ูุญุชุงุฌ ูุนุฑูุฉ ุงููุบุฉ ุงููุฏู ูู ุงูุจุฏุงูุฉ
- ูุชู ุฅุถุงูุฉ token ุฎุงุต ููุบุฉ ูู ุจุฏุงูุฉ ุงูุชุณูุณู

#### ุฎุทูุฉ 3: ุงูุชูููุฏ (Generation)
```python
translated_tokens = model.generate(
    **inputs,
    forced_bos_token_id=target_lang_id,  # ุงููุบุฉ ุงููุฏู
    max_length=512,
    num_beams=5,          # Beam search ููุฌูุฏุฉ
    early_stopping=True
)
```

**ูุง ูุญุฏุซ:**
- ุงููููุฐุฌ ููุฑุฃ ุงููุต ุงูุฅูุฌููุฒู
- ูููุฏ ุงูุชุฑุฌูุฉ ุจุงููุบุฉ ุงููุฏู
- Beam search ูุจุญุซ ุนู ุฃูุถู ุชุฑุฌูุฉ ูุญุชููุฉ

#### ุฎุทูุฉ 4: ูู ุงูุชุฑููุฒ (Decoding)
```python
translated_texts = tokenizer.batch_decode(
    translated_tokens,
    skip_special_tokens=True
)
```

**ูุซุงู:**
```
Tokens: [256047, 13374, 1398, 4260, 4039, 248130, 2]
Text: "Allah'ฤฑn Resulรผnรผn ลรถyle dediฤini duydum: Yapฤฑlanlar niyetlerle deฤerlendirilir"
```

---

## ุงููุฑุญูุฉ 5: ูุญุต ุงูุฌูุฏุฉ

### 5.1 Back-Translation (ุงูุชุฑุฌูุฉ ุงูุนูุณูุฉ)
```python
# ุชุฑุฌูุฉ ุงููุต ุงููุชุฑุฌู ูุฑุฉ ุฃุฎุฑู ููุฅูุฌููุฒูุฉ
back_translated = translator.translate(translated_text, "eng_Latn")
```

**ุงููุฏู:**
- ุงูุชุญูู ูู ุฃู ุงููุนูู ูู ูุชุบูุฑ
- ุฅุฐุง ูุงูุช ุงูุชุฑุฌูุฉ ุงูุนูุณูุฉ ูุฑูุจุฉ ูู ุงูุฃุตูุ ูุงูุชุฑุฌูุฉ ุฌูุฏุฉ

**ูุซุงู:**
```
Original: "Actions are judged by intentions"
Translated: "Yapฤฑlanlar niyetlerle deฤerlendirilir"
Back-translated: "Actions are judged by intentions" โ
```

### 5.2 Semantic Similarity (ุงูุชุดุงุจู ุงูุฏูุงูู)
```python
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('all-MiniLM-L6-v2')
embeddings_original = model.encode(original_text)
embeddings_translated = model.encode(translated_text)
similarity = cosine_similarity(embeddings_original, embeddings_translated)
```

**ูุง ูุญุฏุซ:**
- ุชุญููู ุงููุตูู ุฅูู ูุชุฌูุงุช (vectors)
- ุญุณุงุจ ุงูุชุดุงุจู ุจูู ุงููุชุฌูุงุช
- ุฅุฐุง ูุงู ุงูุชุดุงุจู > 0.85 = ุฌูุฏุฉ ุนุงููุฉ

### 5.3 Length Ratio (ูุณุจุฉ ุงูุทูู)
```python
length_ratio = len(translated_text) / len(original_text)
if 0.5 < length_ratio < 2.5:
    # ุงูุทูู ูุนููู
```

**ุงููุฏู:**
- ุงูุชุญูู ูู ุฃู ุงูุชุฑุฌูุฉ ููุณุช ูุตูุฑุฉ ุฌุฏุงู ุฃู ุทูููุฉ ุฌุฏุงู
- ุงููุณุจุฉ ุงููุนูููุฉ: 0.5 - 2.5

### 5.4 ุชุตููู ุงูุซูุฉ
```python
if similarity >= 0.85 and length_ratio_ok:
    confidence = "HIGH"
elif similarity >= 0.70:
    confidence = "MEDIUM"
else:
    confidence = "LOW"
```

**ุงููุณุชููุงุช:**
- **HIGH**: ุฌูุฏุฉ ููุชุงุฒุฉุ ูุง ุชุญุชุงุฌ ูุฑุงุฌุนุฉ
- **MEDIUM**: ุฌูุฏุฉ ุฌูุฏุฉุ ูุฏ ุชุญุชุงุฌ ูุฑุงุฌุนุฉ
- **LOW**: ุฌูุฏุฉ ููุฎูุถุฉุ ุชุญุชุงุฌ ูุฑุงุฌุนุฉ GPT

---

## ุงููุฑุญูุฉ 6: ูุฑุงุฌุนุฉ GPT (ุงุฎุชูุงุฑู)

### 6.1 ุชุฌููุน ุงูุชุฑุฌูุงุช ุงููุดููู ูููุง
```python
hadiths_to_review = [
    h for h in translated_hadiths 
    if h['quality']['confidence'] == 'LOW'
]
```

### 6.2 ูุฑุงุฌุนุฉ ุจุงูุฏูุนุงุช
```python
batch_size = 10
for i in range(0, len(hadiths_to_review), batch_size):
    batch = hadiths_to_review[i:i+batch_size]
    reviewed = reviewer.review_batch(batch, language)
```

**ูุง ูุญุฏุซ:**
- ุฅุฑุณุงู ุฏูุนุฉ ูู ุงูุชุฑุฌูุงุช ุงููุดููู ูููุง ูู GPT
- GPT ููุญุต ูู ุชุฑุฌูุฉ ูููุชุฑุญ ุชุญุณููุงุช
- ุญูุธ ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

---

## ุงููุฑุญูุฉ 7: ุญูุธ ุงููุชุงุฆุฌ

### 7.1 ุญูุธ Checkpoint
```python
checkpoint = {
    "language": "turkish",
    "processed_hadiths": [...],  # ูุงุฆูุฉ IDs ุงููุชุฑุฌูุฉ
    "stats": {
        "total_translated": 150,
        "high_confidence": 120,
        "medium_confidence": 25,
        "low_confidence": 5
    }
}
save_checkpoint(checkpoint)
```

**ุงููุฏู:**
- ุญูุธ ุงูุชูุฏู ุจุดูู ุฏูุฑู
- ุฅููุงููุฉ ุงุณุชุฆูุงู ุงูุชุฑุฌูุฉ ูู ุขุฎุฑ ููุทุฉ

### 7.2 ุญูุธ ุงูุชุฑุฌูุงุช
```python
output = {
    "hadith_id": {
        "narrator": "...",
        "text": "ุงูุชุฑุฌูุฉ ุงูุชุฑููุฉ",
        "quality": {
            "confidence": "HIGH",
            "similarity": 0.92,
            "needs_review": False
        }
    }
}
save_to_json(output, "output/turkish/all_translations.json")
```

---

## ุงููุฑุญูุฉ 8: ุงูุชูุงูู ุงูููุงุฆู

### 8.1 ุฅูุดุงุก ูููุงุช ุงููุตูู ุงููุชุฑุฌูุฉ
```python
# ููู ูุตูุ ุฅูุดุงุก ููู ูุชุฑุฌู
# ูุซุงู: 1.json -> 1_tr.json
chapter_tr = {
    "metadata": {...},
    "hadiths": [
        {
            "id": "...",
            "arabic": {...},
            "english": {...},
            "turkish": {
                "narrator": "...",
                "text": "..."
            }
        }
    ]
}
```

### 8.2 ุชุญุฏูุซ index.json
```python
# ุชุญุฏูุซ ุญุงูุฉ ุงููุบุฉ
"availableLanguages": [
    {
        "code": "tr",
        "status": "available"  # ูุงู "pending"
    }
]
```

---

## ุงููุฎุทุท ุงูุชุฏููู ุงููุงูู

```
โโโโโโโโโโโโโโโโโโโ
โ  ุชุญููู ุงููููุฐุฌ  โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ุชุญููู ุงููุชุจ    โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ููู ูุชุงุจ:      โ
โ  - ุชุญููู ุงููุตูู โ
โ  - ุงุณุชุฎุฑุงุฌ ุงููุตูุตโ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ุชุฌููุน ุงููุตูุต   โ
โ  ูู ุฏูุนุงุช (8)   โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ุงูุชุฑุฌูุฉ ุจุงูุฏูุนุงุชโ
โ  (NLLB)         โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ูุญุต ุงูุฌูุฏุฉ:    โ
โ  - Back-translationโ
โ  - Semantic similarityโ
โ  - Length ratio โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโ
โ  ุชุตููู ุงูุซูุฉ:   โ
โ  HIGH/MEDIUM/LOWโ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โโโโ HIGH โโโโโบ ุญูุธ ูุจุงุดุฑุฉ
         โ
         โโโโ MEDIUM โโโบ ุญูุธ ูุน ุนูุงูุฉ
         โ
         โโโโ LOW โโโโโโบ ูุฑุงุฌุนุฉ GPT
                          โ
                          โผ
                    โโโโโโโโโโโโโโโ
                    โ  ุญูุธ ุงููุชุงุฆุฌ โ
                    โโโโโโโโโโโโโโโ
```

---

## ูุซุงู ุนููู ูุงูู

### ุงููุฏุฎูุงุช:
```json
{
  "id": "bukhari_1",
  "english": {
    "narrator": "I heard the Messenger of Allah say:",
    "text": "Actions are judged by intentions."
  }
}
```

### ุงูุนูููุฉ:

1. **ุงุณุชุฎุฑุงุฌ ุงููุต:**
   ```
   "I heard the Messenger of Allah say: Actions are judged by intentions."
   ```

2. **Tokenization:**
   ```
   [256047, 13374, 1398, 4260, 4039, 248130, 2]
   ```

3. **ุงูุชุฑุฌูุฉ (NLLB):**
   ```
   "Allah'ฤฑn Resulรผnรผn ลรถyle dediฤini duydum: Yapฤฑlanlar niyetlerle deฤerlendirilir"
   ```

4. **ูุญุต ุงูุฌูุฏุฉ:**
   - Back-translation: โ ูุทุงุจู
   - Similarity: 0.92 (ุนุงููุฉ)
   - Length ratio: 1.1 (ูุนููู)
   - **Confidence: HIGH**

5. **ุงูุญูุธ:**
   ```json
   {
     "bukhari_1": {
       "narrator": "I heard the Messenger of Allah say:",
       "text": "Allah'ฤฑn Resulรผnรผn ลรถyle dediฤini duydum: Yapฤฑlanlar niyetlerle deฤerlendirilir",
       "quality": {
         "confidence": "HIGH",
         "similarity": 0.92,
         "needs_review": false
       }
     }
   }
   ```

---

## ุงูุฃุฏุงุก ูุงูุณุฑุนุฉ

### ูุจู ุงูุชุญุณูู (ุชุฑุฌูุฉ ูุฑุฏูุฉ):
- **ููุช ูู ุญุฏูุซ:** ~10 ุซูุงูู
- **ููุช ูู ูุตู:** ~25 ุฏูููุฉ
- **ููุช ุงููุชุงุจ ุงููุงูู:** ุนุฏุฉ ุณุงุนุงุช

### ุจุนุฏ ุงูุชุญุณูู (batch processing):
- **ููุช ูู ุฏูุนุฉ (8 ุฃุญุงุฏูุซ):** ~15 ุซุงููุฉ
- **ููุช ูู ุญุฏูุซ:** ~2 ุซุงููุฉ
- **ููุช ูู ูุตู:** ~5-10 ุฏูุงุฆู
- **ููุช ุงููุชุงุจ ุงููุงูู:** ุณุงุนุงุช ุฃูู ุจูุซูุฑ

**ุงูุชุญุณูู:** ุฃุณุฑุน ุจู 5-10 ูุฑุงุช!

---

## ุงููููุงุช ุงููููุฉ

1. **`translator.py`**: ููุทู ุงูุชุฑุฌูุฉ ุงูุฃุณุงุณู
2. **`quality_check.py`**: ูุญุต ุงูุฌูุฏุฉ
3. **`reviewer.py`**: ูุฑุงุฌุนุฉ GPT
4. **`run_translation.py`**: ุงูุชูุณูู ุงูุนุงู
5. **`config.py`**: ุงูุฅุนุฏุงุฏุงุช ูุงูุซูุงุจุช

---

## ุงูุฎูุงุตุฉ

ุงููุธุงู ูุนูู ุจุดูู **ุชููุงุฆู** ู**ุฐูู**:
- โ ูุชุฑุฌู ุจุงูุฏูุนุงุช ููุณุฑุนุฉ
- โ ููุญุต ุงูุฌูุฏุฉ ุชููุงุฆูุงู
- โ ูุญูุธ ุงูุชูุฏู ุจุดูู ุฏูุฑู
- โ ูุฑุงุฌุน ุงูุชุฑุฌูุงุช ุงููุดููู ูููุง
- โ ูููู ุงุณุชุฆูุงูู ูู ุฃู ููุทุฉ

ูู ูุง ุนููู ูุนูู ูู ุชุดุบููู ูุงูุชุธุงุฑ ุงููุชุงุฆุฌ! ๐
