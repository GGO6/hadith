# قائمة التحقق: تشغيل التطبيق بشكل جيد على Railway

## 1. البناء (Build)

- [ ] **النشر من جذر المستودع**  
  تأكد أن خدمة `hadith` على Railway مربوطة بمستودع Git وأن البناء من **جذر المستودع** (وليس من مجلد فرعي).

- [ ] **استخدام Dockerfile**  
  في المشروع يجب وجود:
  - `Dockerfile` في **جذر المستودع**
  - `railway.toml` في الجذر مع:
    ```toml
    [build]
    builder = "DOCKERFILE"
    dockerfilePath = "Dockerfile"
    ```
  إذا كان Railway يبني بـ Nixpacks بدلاً من Docker: من إعدادات الخدمة → **Settings** → **Build** → اختر **Dockerfile**.

---

## 2. متغيرات البيئة (Variables)

في خدمة **hadith** (التطبيق) → **Variables**:

| المتغير | مطلوب؟ | الوصف |
|--------|--------|--------|
| `OPENAI_API_KEY` | **نعم** | مفتاح OpenAI (مثل `sk-...`) لتشغيل الترجمة |
| `DATABASE_URL` | **موصى به** | يُضاف تلقائياً عند ربط خدمة **Postgres**. بدونها يُستخدم SQLite (البيانات تضيع عند إعادة النشر) |

لا تحتاج لإنشاء `DATABASE_URL` يدوياً إذا ربطت خدمة Postgres بتطبيق hadith من لوحة Railway (الرابط يضيف المتغير تلقائياً).

---

## 3. قاعدة البيانات (PostgreSQL)

- [ ] إضافة خدمة **Postgres** من **+ New** → **Database** → **Add PostgreSQL**.
- [ ] ربط خدمة **hadith** بـ **Postgres** (السهم في Architecture أو من Variables → Add Reference من Postgres).
- [ ] بعد الربط، إعادة النشر (**Redeploy**) لخدمة hadith حتى يقرأ `DATABASE_URL` وينشئ الجداول.

بدون Postgres: التطبيق يعمل لكن التقدم والترجمات تُحفظ في SQLite داخل الحاوية وتُفقد عند كل إعادة نشر.

---

## 4. بيانات الكتب (ضرورية لشغّل الترجمة)

التطبيق يترجم من **ملفات الكتب الإنجليزية** (مجلد `data/books` بهيكل مشروع hadith).

**الوضع الحالي: الكتب مضمّنة في Docker**

- الـ **Dockerfile** ينسخ مجلد `hadith/books/` وملف `hadith/index.json` إلى الصورة (`/app/data/books` و `/app/data/index.json`).
- طالما المستودع يحتوي مجلد `hadith/books` وملف `hadith/index.json`، النشر من جذر المستودع يضمّن الكتب تلقائياً ولا تحتاج Volume لملفات الكتب.
- **ملاحظة:** حجم الصورة ووقت البناء سيزيدان قليلاً؛ إذا أردت استثناء الكتب من الصورة (مثلاً للاختبار السريع)، يمكنك تعليق أو حذف سطور `COPY hadith/books/` و `COPY hadith/index.json` من الـ Dockerfile.

**بديل – استخدام Volume فقط للكتب**

- إذا فضّلت عدم تضمين الكتب في الصورة: أضف Volume واربطه بـ `/app/data` وانسخ الكتب هناك (مثلاً عبر One-off command أو أداة خارجية).

---

## 5. التأكد من أن التطبيق يعمل بشكل جيد

- [ ] بعد النشر، افتح رابط التطبيق (مثل `https://hadith-production.up.railway.app`).
- [ ] يجب أن تظهر لوحة التحكم بدون خطأ 5xx.
- [ ] من **Observability** أو **Logs** تأكد أنه لا يوجد استثناءات عند فتح الصفحة (مثلاً أخطاء اتصال بقاعدة البيانات).
- [ ] إذا أضفت Postgres: عند أول تحميل للوحة يُفترض أن التطبيق ينشئ الجداول تلقائياً؛ لا تحتاج تشغيل أوامر يدوية.

---

## 6. ملخص سريع

| المطلوب | الحالة |
|---------|--------|
| بناء من Dockerfile (جذر المستودع) | ✅ من `railway.toml` |
| `OPENAI_API_KEY` في Variables | ⬜ ضبطه يدوياً |
| ربط Postgres وإضافة `DATABASE_URL` | ⬜ من لوحة Railway |
| بيانات الكتب في `data/books` | ✅ مضمّنة في Docker من `hadith/books` و `hadith/index.json` |

بعد إكمال هذه النقاط، التطبيق يعمل بشكل جيد على Railway: اللوحة تعمل، التقدم والترجمات تُحفظ في Postgres، والترجمة الفعلية تعمل عندما تكون ملفات الكتب متوفرة في المسار المطلوب.
